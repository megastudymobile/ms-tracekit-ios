# ğŸ”Œ ì™¸ë¶€ ì—°ë™

> ì‘ì„±ì¼: 2025-12-15
> ì‘ì„±ì: jimmy

## ê°œìš”

TraceKitëŠ” `TraceDestination` í”„ë¡œí† ì½œì„ í†µí•´ ì™¸ë¶€ ëª¨ë‹ˆí„°ë§/ë¶„ì„ ì„œë¹„ìŠ¤ì™€ ì‰½ê²Œ ì—°ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³„ë„ ëª¨ë“ˆì´ ì•„ë‹Œ **í”„ë¡œí† ì½œ êµ¬í˜„**ìœ¼ë¡œ í†µí•©í•˜ë¯€ë¡œ ì˜ì¡´ì„±ì´ ê°€ë³ê³  ìœ ì—°í•©ë‹ˆë‹¤.

> ğŸ’¡ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™ í›„ì—ë„ ë™ê¸° API(`TraceKit.error(...)`)ë¡œ ê°„í¸í•˜ê²Œ ë¡œê¹…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> ë‚´ë¶€ì ìœ¼ë¡œ Fire-and-Forget íŒ¨í„´ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.

| ì—°ë™ ì„œë¹„ìŠ¤ | ìš©ë„ | êµ¬í˜„ ìƒíƒœ |
|---------|------|---------|
| Firebase Crashlytics | í¬ë˜ì‹œ ë¦¬í¬íŒ…, Breadcrumb | âœ… ë°ëª¨ ì•± êµ¬í˜„ |
| Firebase Analytics | ì´ë²¤íŠ¸ íŠ¸ë˜í‚¹ | âœ… ë°ëª¨ ì•± êµ¬í˜„ |
| Sentry | ì—ëŸ¬ ëª¨ë‹ˆí„°ë§, ì´ìŠˆ ì¶”ì  | ğŸ”§ ì‚¬ìš©ì êµ¬í˜„ ê°€ëŠ¥ |
| Datadog | ë¡œê·¸ ë¶„ì„, ë©”íŠ¸ë¦­ | ğŸ”§ ì‚¬ìš©ì êµ¬í˜„ ê°€ëŠ¥ |

## TraceDestination í”„ë¡œí† ì½œ

ëª¨ë“  ì™¸ë¶€ ì—°ë™ì€ `TraceDestination` í”„ë¡œí† ì½œì„ êµ¬í˜„í•˜ì—¬ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

```swift
public protocol TraceDestination: Actor {
    var identifier: String { get }
    var minLevel: TraceLevel { get set }
    var isEnabled: Bool { get set }
    func log(_ message: TraceMessage) async
    func flush(_ messages: [TraceMessage]) async
}
```

## Firebase Crashlytics ì—°ë™

### ê°œìš”

ë°ëª¨ ì•±(`TraceKitDemo`)ì— êµ¬í˜„ëœ `FirebaseCrashlyticsTraceDestination`ì€ TraceKit ë¡œê·¸ë¥¼ Firebase Crashlyticsë¡œ ì „ì†¡í•˜ëŠ” ì‹¤ì œ êµ¬í˜„ ì˜ˆì‹œì…ë‹ˆë‹¤.

### ì„¤ì¹˜

1. Firebase SDK ì¶”ê°€ (SPM)

```swift
// Package.swift ë˜ëŠ” Tuist Dependencies.swift
.package(url: "https://github.com/firebase/firebase-ios-sdk", from: "10.0.0")
```

2. `GoogleService-Info.plist` ì¶”ê°€

### êµ¬í˜„ ì°¸ê³ 

ë°ëª¨ ì•±ì˜ êµ¬í˜„ì„ ì°¸ê³ í•˜ì—¬ í”„ë¡œì íŠ¸ì— ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```
Projects/TraceKitDemo/Sources/Infrastructure/
â”œâ”€â”€ FirebaseCrashlyticsTraceDestination.swift  # Crashlytics ì—°ë™
â””â”€â”€ FirebaseAnalyticsTraceDestination.swift    # Analytics ì—°ë™
```

### ì´ˆê¸°í™”

```swift
import TraceKit
import FirebaseCore
import FirebaseCrashlytics

@main
struct MyApp: App {
    init() {
        // Firebase ì´ˆê¸°í™”
        FirebaseApp.configure()
        
        Task {
            await setupTraceKit()
        }
    }
    
    @TraceKitActor
    func setupTraceKit() async {
        // ë°ëª¨ ì•± êµ¬í˜„ì„ ë³µì‚¬í•˜ê±°ë‚˜ ì§ì ‘ êµ¬í˜„
        let crashlyticsDestination = FirebaseCrashlyticsTraceDestination()
        
        let logger = await TraceKitBuilder()
            .addConsole()
            .addDestination(crashlyticsDestination)
            .buildAsShared()
    }
}
```

### ë™ì‘ ë°©ì‹

```mermaid
%%{init: {
  'theme': 'dark',
  'themeVariables': { 'lineColor': '#e2e8f0', 'textColor': '#f8fafc' }
}}%%
flowchart LR
    subgraph TraceKit
        L["TraceMessage"]
    end
    
    subgraph Crashlytics["FirebaseCrashlyticsTraceDestination"]
        LOG["log() - Breadcrumb"]
        REC["recordError() - ëª…ì‹œì  ì—ëŸ¬"]
    end
    
    subgraph Firebase["Firebase SDK"]
        CL["Crashlytics.log"]
        CE["Crashlytics.record"]
    end
    
    L -->|debug ì´ìƒ| LOG
    L -->|error ì´ìƒ| REC
    LOG --> CL
    REC --> CE
    
    classDef log fill:#3b82f6,stroke:#60a5fa,color:#ffffff
    classDef crash fill:#f59e0b,stroke:#fbbf24,color:#1f2937
    classDef firebase fill:#ef4444,stroke:#f87171,color:#ffffff
    
    class L log
    class LOG,REC crash
    class CL,CE firebase
```

| ë ˆë²¨ | Breadcrumb | recordError() |
|-----|-----------|---------------|
| verbose | âŒ | âŒ |
| debug | âœ… | âŒ |
| info | âœ… | âŒ |
| warning | âœ… | âŒ |
| error | âœ… | âœ… (Non-fatal) |
| fatal | âœ… | âœ… (Non-fatal) |

### êµ¬í˜„ ì˜ˆì‹œ

```swift
import Foundation
import TraceKit
import FirebaseCrashlytics

actor FirebaseCrashlyticsTraceDestination: TraceDestination {
    private nonisolated let crashlytics = Crashlytics.crashlytics()
    
    nonisolated var identifier: String { "firebase.crashlytics" }
    var minLevel: TraceLevel = .debug
    var isEnabled: Bool = true
    
    func log(_ message: TraceMessage) async {
        guard shouldLog(message) else { return }
        
        // Breadcrumbë¡œ ê¸°ë¡
        let breadcrumb = formatBreadcrumb(message)
        crashlytics.log(breadcrumb)
        
        // ì—ëŸ¬ ë ˆë²¨ì€ ëª…ì‹œì  ì—ëŸ¬ë¡œ ê¸°ë¡
        if message.level >= .error {
            recordError(message)
        }
    }
    
    private func formatBreadcrumb(_ message: TraceMessage) -> String {
        "[\(message.level.name)] [\(message.category)] \(message.message)"
    }
    
    private func recordError(_ message: TraceMessage) {
        let error = NSError(
            domain: "com.myapp",
            code: message.level.rawValue,
            userInfo: [
                NSLocalizedDescriptionKey: message.message,
                "category": message.category,
                "level": message.level.name
            ]
        )
        crashlytics.record(error: error)
    }
}
```

## Firebase Analytics ì—°ë™

### ê°œìš”

TraceKit ë¡œê·¸ë¥¼ Firebase Analytics ì´ë²¤íŠ¸ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### êµ¬í˜„ ì˜ˆì‹œ

```swift
import Foundation
import TraceKit
import FirebaseAnalytics

actor FirebaseAnalyticsTraceDestination: TraceDestination {
    nonisolated var identifier: String { "firebase.analytics" }
    var minLevel: TraceLevel = .info
    var isEnabled: Bool = true
    
    func log(_ message: TraceMessage) async {
        guard shouldLog(message) else { return }
        
        // ì—ëŸ¬ ë ˆë²¨ë§Œ ì´ë²¤íŠ¸ë¡œ ì „ì†¡
        guard message.level >= .error else { return }
        
        Analytics.logEvent("trace_error", parameters: [
            "level": message.level.name,
            "category": message.category,
            "message": message.message,
            "file": message.fileName,
            "line": message.line
        ])
    }
}
```

## Sentry ì—°ë™ (êµ¬í˜„ ì˜ˆì‹œ)

### ì„¤ì¹˜

```swift
// Package.swift
.package(url: "https://github.com/getsentry/sentry-cocoa", from: "8.0.0")
```

### êµ¬í˜„ ì˜ˆì‹œ

```swift
import Foundation
import TraceKit
import Sentry

actor SentryTraceDestination: TraceDestination {
    private let dsn: String
    private let environment: String
    
    nonisolated var identifier: String { "sentry" }
    var minLevel: TraceLevel = .warning
    var isEnabled: Bool = true
    
    init(dsn: String, environment: String = "production") {
        self.dsn = dsn
        self.environment = environment
        
        // Sentry SDK ì´ˆê¸°í™”
        SentrySDK.start { options in
            options.dsn = dsn
            options.environment = environment
        }
    }
    
    func log(_ message: TraceMessage) async {
        guard shouldLog(message) else { return }
        
        // Breadcrumb ì¶”ê°€
        let breadcrumb = Breadcrumb(
            level: sentryLevel(from: message.level),
            category: message.category
        )
        breadcrumb.message = message.message
        SentrySDK.addBreadcrumb(breadcrumb)
        
        // ì—ëŸ¬ëŠ” ì´ë²¤íŠ¸ë¡œ ì „ì†¡
        if message.level >= .error {
            let event = Event(level: sentryLevel(from: message.level))
            event.message = SentryMessage(formatted: message.message)
            event.tags = ["category": message.category]
            SentrySDK.capture(event: event)
        }
    }
    
    private func sentryLevel(from level: TraceLevel) -> SentryLevel {
        switch level {
        case .verbose, .debug: return .debug
        case .info: return .info
        case .warning: return .warning
        case .error: return .error
        case .fatal: return .fatal
        }
    }
}
```

### ì‚¬ìš©ë²•

```swift
let sentryDestination = SentryTraceDestination(
    dsn: "https://xxx@sentry.io/123",
    environment: "production"
)

let logger = await TraceKitBuilder()
    .addConsole()
    .addDestination(sentryDestination)
    .buildAsShared()
```

## Datadog ì—°ë™ (êµ¬í˜„ ì˜ˆì‹œ)

### ì„¤ì¹˜

```swift
// Package.swift
.package(url: "https://github.com/DataDog/dd-sdk-ios", from: "2.0.0")
```

### êµ¬í˜„ ì˜ˆì‹œ

```swift
import Foundation
import TraceKit
import DatadogCore
import DatadogLogs

actor DatadogTraceDestination: TraceDestination {
    private let logger: LoggerProtocol
    
    nonisolated var identifier: String { "datadog" }
    var minLevel: TraceLevel = .info
    var isEnabled: Bool = true
    
    init(clientToken: String, environment: String, serviceName: String) {
        // Datadog SDK ì´ˆê¸°í™”
        Datadog.initialize(
            with: Datadog.Configuration(
                clientToken: clientToken,
                env: environment,
                service: serviceName
            ),
            trackingConsent: .granted
        )
        
        logger = Logger.create()
    }
    
    func log(_ message: TraceMessage) async {
        guard shouldLog(message) else { return }
        
        let attributes: [String: Encodable] = [
            "category": message.category,
            "file": message.fileName,
            "function": message.function,
            "line": message.line
        ]
        
        switch message.level {
        case .verbose, .debug:
            logger.debug(message.message, attributes: attributes)
        case .info:
            logger.info(message.message, attributes: attributes)
        case .warning:
            logger.warn(message.message, attributes: attributes)
        case .error:
            logger.error(message.message, attributes: attributes)
        case .fatal:
            logger.critical(message.message, attributes: attributes)
        }
    }
}
```

### ì‚¬ìš©ë²•

```swift
let datadogDestination = DatadogTraceDestination(
    clientToken: "pub_xxx",
    environment: "production",
    serviceName: "my-ios-app"
)

let logger = await TraceKitBuilder()
    .addConsole()
    .addDestination(datadogDestination)
    .buildAsShared()
```

## ë³µí•© êµ¬ì„± ì˜ˆì œ

### ëª¨ë“  ì„œë¹„ìŠ¤ ì—°ë™

```swift
import TraceKit
import FirebaseCore

@TraceKitActor
func setupProductionTraceKit() async {
    // Firebase ì´ˆê¸°í™”
    FirebaseApp.configure()
    
    // Firebase Crashlytics (ë°ëª¨ ì•± êµ¬í˜„ ì°¸ì¡°)
    let crashlyticsDestination = FirebaseCrashlyticsTraceDestination()
    
    // Sentry (ì‚¬ìš©ì êµ¬í˜„)
    let sentryDestination = SentryTraceDestination(
        dsn: "https://xxx@sentry.io/123",
        environment: "production"
    )
    
    // Datadog (ì‚¬ìš©ì êµ¬í˜„)
    let datadogDestination = DatadogTraceDestination(
        clientToken: "pub_xxx",
        environment: "production",
        serviceName: "my-app"
    )
    
    // TraceKit êµ¬ì„±
    let logger = await TraceKitBuilder()
        // ë¡œì»¬ ì¶œë ¥
        .addConsole(minLevel: .warning)
        .addOSLog(minLevel: .info)
        .addFile(minLevel: .debug)
        
        // ì™¸ë¶€ ì„œë¹„ìŠ¤
        .addDestination(crashlyticsDestination)
        .addDestination(sentryDestination)
        .addDestination(datadogDestination)
        
        // ì •ì±…
        .withBuffer(policy: .default)
        .withSampling(policy: .production)
        .withDefaultSanitizer()
        .withDefaultContextProvider(environment: .production)
        
        .buildAsShared()
}
```

### í™˜ê²½ë³„ êµ¬ì„±

```swift
@TraceKitActor
func setupTraceKit(environment: Environment) async {
    let builder = TraceKitBuilder()
        .addConsole(formatter: PrettyTraceFormatter.verbose)
        .withDefaultSanitizer()
    
    switch environment {
    case .debug:
        // ë””ë²„ê·¸: ì½˜ì†”ë§Œ
        _ = await builder
            .with(configuration: .debug)
            .buildAsShared()
        
    case .staging:
        // ìŠ¤í…Œì´ì§•: ì½˜ì†” + Firebase
        FirebaseApp.configure()
        let crashlytics = FirebaseCrashlyticsTraceDestination()
        _ = await builder
            .addDestination(crashlytics)
            .buildAsShared()
        
    case .production:
        // í”„ë¡œë•ì…˜: ì „ì²´ êµ¬ì„±
        FirebaseApp.configure()
        let crashlytics = FirebaseCrashlyticsTraceDestination()
        let sentry = SentryTraceDestination(
            dsn: "https://xxx@sentry.io/prod",
            environment: "production"
        )
        
        _ = await builder
            .addOSLog(minLevel: .info)
            .addFile(minLevel: .info)
            .addDestination(crashlytics)
            .addDestination(sentry)
            .withBuffer(policy: .default)
            .withSampling(policy: .production)
            .buildAsShared()
    }
}
```

## ì»¤ìŠ¤í…€ Destination êµ¬í˜„ ê°€ì´ë“œ

### ê¸°ë³¸ êµ¬ì¡°

```swift
import Foundation
import TraceKit

actor MyCustomDestination: TraceDestination {
    // í•„ìˆ˜ í”„ë¡œí¼í‹°
    nonisolated var identifier: String { "my.custom" }
    var minLevel: TraceLevel = .info
    var isEnabled: Bool = true
    
    // ì´ˆê¸°í™”
    init(/* í•„ìš”í•œ ì„¤ì • */) {
        // SDK ì´ˆê¸°í™” ë“±
    }
    
    // í•„ìˆ˜ ë©”ì„œë“œ
    func log(_ message: TraceMessage) async {
        guard shouldLog(message) else { return }
        
        // ì™¸ë¶€ ì„œë¹„ìŠ¤ë¡œ ë¡œê·¸ ì „ì†¡
        await sendToExternalService(message)
    }
    
    // flushëŠ” ê¸°ë³¸ êµ¬í˜„ ì‚¬ìš© ê°€ëŠ¥ (ë°°ì¹˜ ì²˜ë¦¬ê°€ í•„ìš”í•œ ê²½ìš°ë§Œ override)
    func flush(_ messages: [TraceMessage]) async {
        // ë°°ì¹˜ ì „ì†¡ ìµœì í™”
        for message in messages {
            await log(message)
        }
    }
    
    private func sendToExternalService(_ message: TraceMessage) async {
        // êµ¬í˜„
    }
}
```

### êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `TraceDestination` í”„ë¡œí† ì½œ ì±„íƒ
- [ ] `identifier`ë¥¼ ê³ ìœ í•œ ê°’ìœ¼ë¡œ ì„¤ì •
- [ ] `log(_:)` ë©”ì„œë“œì—ì„œ `shouldLog(_:)` í™•ì¸
- [ ] Actorë¡œ êµ¬í˜„í•˜ì—¬ ìŠ¤ë ˆë“œ ì•ˆì „ì„± ë³´ì¥
- [ ] ì™¸ë¶€ SDK ì´ˆê¸°í™” ìˆœì„œ ê³ ë ¤
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë¡œì§ êµ¬í˜„
- [ ] ë¯¼ê°ì •ë³´ëŠ” ì´ë¯¸ ì •ì œëœ ìƒíƒœë¡œ ìˆ˜ì‹ ë¨ (ì¶”ê°€ ì²˜ë¦¬ ë¶ˆí•„ìš”)

## ë°ëª¨ ì•±ì—ì„œ í™•ì¸í•˜ê¸°

TraceKitDemo ì•±ì—ì„œ ì‹¤ì œ êµ¬í˜„ ì˜ˆì‹œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **Firebase Crashlytics ì—°ë™**: `CrashlyticsRealtime` íƒ­
- **Firebase Analytics ì—°ë™**: `AnalyticsRealtime` íƒ­
- **êµ¬í˜„ ì½”ë“œ**: `Projects/TraceKitDemo/Sources/Infrastructure/`

ìì„¸í•œ ë‚´ìš©ì€ [ë°ëª¨ ì•±](./07-ë°ëª¨-ì•±.md) ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

## ë¬¸ì œ í•´ê²°

### Firebase ë¡œê·¸ê°€ ë³´ì´ì§€ ì•ŠìŒ

1. `GoogleService-Info.plist` í™•ì¸
2. `FirebaseApp.configure()` í˜¸ì¶œ í™•ì¸
3. í¬ë˜ì‹œ ë°œìƒ í›„ ì•± ì¬ì‹¤í–‰ í•„ìš”
4. ë””ë²„ê±° ì—°ê²° ì‹œ í¬ë˜ì‹œ ë¦¬í¬íŠ¸ ë¹„í™œì„±í™”ë¨

### ì™¸ë¶€ SDK ì´ˆê¸°í™” ìˆœì„œ

```swift
// ì˜¬ë°”ë¥¸ ìˆœì„œ
FirebaseApp.configure()          // 1. Firebase ì´ˆê¸°í™”
Datadog.initialize(...)          // 2. Datadog ì´ˆê¸°í™”
SentrySDK.start { ... }          // 3. Sentry ì´ˆê¸°í™”

// ê·¸ ë‹¤ìŒ TraceKit ì„¤ì •
await TraceKitBuilder()
    .addDestination(...)
    .buildAsShared()
```

### ìƒ˜í”Œë§ìœ¼ë¡œ ë¡œê·¸ê°€ í•„í„°ë§ë¨

ìƒ˜í”Œë§ ì •ì±…ì´ í™œì„±í™”ëœ ê²½ìš° ì¼ë¶€ ë¡œê·¸ê°€ ì™¸ë¶€ ì„œë¹„ìŠ¤ë¡œ ì „ì†¡ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹ì • ì¹´í…Œê³ ë¦¬ë‚˜ ë ˆë²¨ì˜ ë¡œê·¸ë¥¼ 100% ì „ì†¡í•˜ë ¤ë©´ ìƒ˜í”Œë§ ì •ì±…ì„ ì¡°ì •í•˜ì„¸ìš”.

```swift
let policy = SamplingPolicy(
    defaultRate: 0.1,
    ratesByCategory: [
        "Auth": 1.0,      // Auth ì¹´í…Œê³ ë¦¬ëŠ” 100% ì „ì†¡
        "Payment": 1.0    // Payment ì¹´í…Œê³ ë¦¬ëŠ” 100% ì „ì†¡
    ],
    alwaysIncludeLevels: [.error, .fatal]
)
```

---

## Firebase í†µí•© ëª¨ë“ˆ

TraceKitê³¼ Firebaseì˜ 4ëŒ€ í•µì‹¬ ì„œë¹„ìŠ¤ë¥¼ ì—°ë™í•˜ëŠ” í†µí•© ëª¨ë“ˆì…ë‹ˆë‹¤.

### ê°œìš”

TraceKitì˜ ë¡œê¹…ê³¼ ì„±ëŠ¥ ì¶”ì  ê¸°ëŠ¥ì„ Firebaseì˜ 4ëŒ€ ì„œë¹„ìŠ¤ì— ìë™ìœ¼ë¡œ ì—°ë™í•©ë‹ˆë‹¤.

| ëª¨ë“ˆ | Firebase ì„œë¹„ìŠ¤ | ì£¼ìš” ê¸°ëŠ¥ | Console ìœ„ì¹˜ |
|------|----------------|-----------|-------------|
| FirebaseAnalyticsTraceDestination | Analytics | ì—ëŸ¬ íŒ¨í„´ ë¶„ì„, ì‚¬ìš©ì í–‰ë™ ì¶”ì  | Analytics > Events |
| FirebaseCrashlyticsTraceDestination | Crashlytics | ì‹¤ì‹œê°„ í¬ë˜ì‹œ ì¶”ì , Breadcrumb | Crashlytics > Dashboard |
| FirebasePerformanceTraceExtension | Performance | ì»¤ìŠ¤í…€ ì„±ëŠ¥ ì¶”ì , ë³‘ëª© ì§€ì  íƒì§€ | Performance > Custom traces |
| FirebaseRemoteConfigManager | Remote Config | ì›ê²© ì„¤ì •, A/B í…ŒìŠ¤íŠ¸, ê¸´ê¸‰ ì„¤ì • ë³€ê²½ | Remote Config > Parameters |

### 1. FirebaseAnalyticsTraceDestination

**ëª©ì **: TraceKit ë¡œê·¸ë¥¼ Firebase Analytics ì´ë²¤íŠ¸ë¡œ ì „ì†¡í•˜ì—¬ ì—ëŸ¬ íŒ¨í„´ ë¶„ì„ ë° BigQuery ì—°ë™

#### ì „ì†¡ ì •ì±…

```
ë ˆë²¨ë³„ ì²˜ë¦¬:
- .error    â†’ trace_error ì´ë²¤íŠ¸ ì „ì†¡
- .fatal    â†’ trace_fatal ì´ë²¤íŠ¸ ì „ì†¡
- ê·¸ ì™¸     â†’ ì „ì†¡ ì•ˆí•¨ (ê³¼ë„í•œ ì´ë²¤íŠ¸ ë°©ì§€)
```

#### ì„¤ì • ë°©ë²•

```swift
// TraceKit ì´ˆê¸°í™” ì‹œ ì¶”ê°€
let analyticsDestination = FirebaseAnalyticsTraceDestination()
await TraceKitBuilder()
    .addDestination(analyticsDestination)
    .buildAsShared()
```

#### Analytics ì´ë²¤íŠ¸ êµ¬ì¡°

ì „ì†¡ë˜ëŠ” ì´ë²¤íŠ¸ íŒŒë¼ë¯¸í„°:

```swift
{
    "level": "error",                    // ë¡œê·¸ ë ˆë²¨
    "category": "Network",               // ë¡œê·¸ ì¹´í…Œê³ ë¦¬
    "message": "API request failed...",  // ë©”ì‹œì§€ (ìµœëŒ€ 100ì)
    "timestamp": "2026-01-22T14:15:00Z"  // ISO8601 íƒ€ì„ìŠ¤íƒ¬í”„
}
```

#### User Properties ìë™ ë™ê¸°í™”

TraceKitì˜ UserContextê°€ Firebase Analytics User Propertiesë¡œ ìë™ ë™ê¸°í™”ë©ë‹ˆë‹¤.

```swift
// UserContextProviderë¥¼ í†µí•´ ì‚¬ìš©ì ì •ë³´ ì„¤ì •
let contextProvider = DefaultUserContextProvider()
await contextProvider.setUserId("user_12345")
await contextProvider.setCustomAttribute("plan", value: "premium")

// TraceKitì— provider ì„¤ì •
await TraceKit.async.setContextProvider(contextProvider)

// ì´í›„ ë¡œê·¸ ë©”ì‹œì§€ì— ìë™ìœ¼ë¡œ UserContextê°€ ì²¨ë¶€ë˜ê³ 
// â†’ Firebase Analyticsì— ìë™ ë™ê¸°í™”
// User ID: user_12345
// User Property: plan = premium
```

#### Firebase Console í™•ì¸

**ì‹¤ì‹œê°„ ë°ì´í„° (ì¦‰ì‹œ í™•ì¸)**
```
Firebase Console > Analytics > Realtime
- trace_error, trace_fatal ì´ë²¤íŠ¸ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œë¨
```

**ì´ë²¤íŠ¸ ë¶„ì„ (24ì‹œê°„ í›„)**
```
Firebase Console > Analytics > Events
- trace_error, trace_fatal í´ë¦­
- ì—ëŸ¬ ë°œìƒ ë¹ˆë„, ì˜í–¥ë°›ì€ ì‚¬ìš©ì ìˆ˜, ë””ë°”ì´ìŠ¤ë³„ í†µê³„ í™•ì¸
```

#### ì œì•½ì‚¬í•­

- ë©”ì‹œì§€ ìµœëŒ€ ê¸¸ì´: 100ì (ì´ˆê³¼ ì‹œ ìë™ ì ˆë‹¨)
- User Property ì´ë¦„: 24ì ì´ë‚´, ì•ŒíŒŒë²³ìœ¼ë¡œ ì‹œì‘
- ë¬´ë£Œ í”Œëœ: í•˜ë£¨ 500ê°œ ì´ë²¤íŠ¸ ì œí•œ

### 2. FirebaseCrashlyticsTraceDestination (ìƒì„¸)

**ëª©ì **: TraceKit ë¡œê·¸ë¥¼ Crashlytics Breadcrumbë¡œ ê¸°ë¡í•˜ì—¬ í¬ë˜ì‹œ ë°œìƒ ì‹œ ë¬¸ë§¥ íŒŒì•…

#### ì „ì†¡ ì •ì±…

```
ë ˆë²¨ë³„ ì²˜ë¦¬:
- .debug, .info, .warning  â†’ Breadcrumb í˜•ì‹ìœ¼ë¡œ ê¸°ë¡
- .error, .fatal           â†’ NSErrorë¡œ ëª…ì‹œì  ê¸°ë¡ + Breadcrumb
```

#### Breadcrumb í˜•ì‹

```
[ERROR] [Network] API request failed: timeout after 30s
[WARNING] [Auth] Token expires in 5 minutes
[INFO] [App] User logged in successfully
```

#### ëª…ì‹œì  ì—ëŸ¬ ê¸°ë¡

.error, .fatal ë ˆë²¨ì€ NSErrorë¡œ ë³€í™˜ë˜ì–´ Crashlyticsì— ëª…ì‹œì ìœ¼ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤.

```swift
NSError {
    domain: "com.tracekit.TraceKitDemo"
    code: 1000 (error) ë˜ëŠ” 2000 (fatal)
    userInfo: {
        "NSLocalizedDescription": "ë©”ì‹œì§€ ë‚´ìš©",
        "category": "Network",
        "level": "error",
        "timestamp": "2026-01-22T14:15:00Z"
    }
}
```

#### User Context ìë™ ë™ê¸°í™”

```swift
// UserContextProviderë¥¼ í†µí•´ ì‚¬ìš©ì ì •ë³´ ì„¤ì •
let contextProvider = DefaultUserContextProvider()
await contextProvider.setUserId("user_12345")
await contextProvider.setCustomAttribute("version", value: "1.2.0")

await TraceKit.async.setContextProvider(contextProvider)

// â†’ Crashlyticsì— ìë™ ë™ê¸°í™”
// Crashlytics User ID: user_12345
// Custom Key: version = 1.2.0
```

#### í™œìš© ì‹œë‚˜ë¦¬ì˜¤

1. í¬ë˜ì‹œ ì¬í˜„ ê²½ë¡œ íŒŒì•…
2. íŠ¹ì • ì‚¬ìš©ìì—ê²Œë§Œ ë°œìƒí•˜ëŠ” ì´ìŠˆ ë¶„ì„
3. í¬ë˜ì‹œ ì§ì „ ì‚¬ìš©ì í–‰ë™ íŒ¨í„´ ë¶„ì„

### 3. FirebasePerformanceTraceExtension

**ëª©ì **: TraceKitì˜ TraceSpanì„ Firebase Performance Monitoringê³¼ ì—°ë™í•˜ì—¬ ì„±ëŠ¥ ë³‘ëª© ì§€ì  íƒì§€

#### ì‚¬ìš© ë°©ë²• 1: TraceSpan ì§ì ‘ ì „ì†¡

```swift
// 1. TraceKit span ìƒì„± ë° ì‘ì—… ìˆ˜í–‰
let spanId = await TraceKit.async.startSpan(name: "fetchUserProfile")

// 2. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
let profile = try await apiClient.fetchUserProfile()

// 3. Span ì¢…ë£Œ ë° Firebase Performance ì „ì†¡
if let completedSpan = await TraceKit.async.tracer.endSpan(id: spanId) {
    await completedSpan.sendToFirebasePerformance()
}
```

#### ì‚¬ìš© ë°©ë²• 2: FirebasePerformanceHelper í™œìš©

```swift
// ì„±ëŠ¥ ì¶”ì ê³¼ í•¨ê»˜ ì‘ì—… ì‹¤í–‰ (TraceKit + Firebase ë™ì‹œ ê¸°ë¡)
let result = try await FirebasePerformanceHelper.trace(name: "processPayment") {
    return try await paymentService.process(order)
}

// ìë™ìœ¼ë¡œ TraceKitê³¼ Firebase Performanceì— ëª¨ë‘ ê¸°ë¡ë¨
```

**ì¥ì•  ëŒ€ì‘**
- Firebase Performance trace ìƒì„± ì‹¤íŒ¨ ì‹œì—ë„ TraceKit spanì€ ì •ìƒ ì‘ë™
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë‚˜ Firebase ì„œë¹„ìŠ¤ ì¥ì• ì— ì˜í–¥ë°›ì§€ ì•ŠìŒ
- ì•± í•µì‹¬ ê¸°ëŠ¥ì€ ë³´í˜¸ë˜ë©° ì„±ëŠ¥ ì¶”ì ë§Œ ì‹¤íŒ¨

#### ì „ì†¡ë˜ëŠ” ë©”íŠ¸ë¦­

Firebase Performanceì— ì „ì†¡ë˜ëŠ” ì„±ëŠ¥ ë°ì´í„°:

```swift
Trace {
    name: "fetchUserProfile"
    metrics: {
        "duration_ms": 1234,           // ì‹¤í–‰ ì‹œê°„ (ë°€ë¦¬ì´ˆ)
        "memory_bytes": 2048000,       // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (ìˆëŠ” ê²½ìš°)
        // ... ê¸°íƒ€ TraceSpanì˜ ìˆ«ìí˜• metadata
    }
    attributes: {
        "user_id": "user_12345",       // ì‚¬ìš©ì ID
        "device_type": "iPhone14",     // ê¸°íƒ€ ë¬¸ìì—´ metadata (ìµœëŒ€ 100ì)
    }
}
```

#### Trace ì´ë¦„ ê·œì¹™

Firebase PerformanceëŠ” ì—„ê²©í•œ ë„¤ì´ë° ê·œì¹™ì´ ìˆìŠµë‹ˆë‹¤:

```
ê·œì¹™:
- ìµœëŒ€ 100ì
- ì•ŒíŒŒë²³ìœ¼ë¡œ ì‹œì‘
- ì•ŒíŒŒë²³, ìˆ«ì, ì–¸ë”ìŠ¤ì½”ì–´ë§Œ í—ˆìš©

ë³€í™˜ ì˜ˆì‹œ:
"Fetch User Profile" â†’ "Fetch_User_Profile"
"123-test"           â†’ "trace_123_test"
```

#### Firebase Console í™•ì¸

```
Firebase Console > Performance > Custom traces
- ì»¤ìŠ¤í…€ trace ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰ (ì˜ˆ: fetchUserProfile)
- Duration, Success rate, Affected users í™•ì¸
- ë””ë°”ì´ìŠ¤ë³„, OS ë²„ì „ë³„ ì„±ëŠ¥ ë¹„êµ
```

#### í™œìš© ì‹œë‚˜ë¦¬ì˜¤

1. API ì‘ë‹µ ì‹œê°„ ëª¨ë‹ˆí„°ë§
2. ë¬´ê±°ìš´ ê³„ì‚° ì‘ì—… ì„±ëŠ¥ ì¶”ì 
3. ì´ë¯¸ì§€ ë¡œë”© ì‹œê°„ ì¸¡ì •
4. ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ì„±ëŠ¥ ë¶„ì„

### 4. FirebaseRemoteConfigManager

**ëª©ì **: ì•± ì—…ë°ì´íŠ¸ ì—†ì´ TraceKitì˜ ë™ì‘ì„ ì›ê²©ìœ¼ë¡œ ì œì–´

#### Remote Config í‚¤

Firebase Consoleì—ì„œ ì„¤ì • ê°€ëŠ¥í•œ í‚¤:

| í‚¤ | íƒ€ì… | ê¸°ë³¸ê°’ | ì„¤ëª… |
|----|------|--------|------|
| `tracekit_min_level` | String | "info" | ìµœì†Œ ë¡œê·¸ ë ˆë²¨ (verbose, debug, info, warning, error, fatal) |
| `tracekit_sampling_rate` | Number | 1.0 | ìƒ˜í”Œë§ ë¹„ìœ¨ (0.0 ~ 1.0) |
| `tracekit_enable_crashlytics` | Boolean | true | Crashlytics ì—°ë™ í™œì„±í™” |
| `tracekit_enable_analytics` | Boolean | true | Analytics ì—°ë™ í™œì„±í™” |
| `tracekit_enable_performance` | Boolean | true | Performance ì—°ë™ í™œì„±í™” |
| `tracekit_enable_sanitizer` | Boolean | true | ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹ í™œì„±í™” |

#### ì´ˆê¸° ì„¤ì •

```swift
// 1. FirebaseRemoteConfigManager ìƒì„±
let remoteConfigManager = FirebaseRemoteConfigManager()

// 2. Remote Config ê°’ ê°€ì ¸ì˜¤ê¸° (1ì‹œê°„ ìºì‹œ ê³ ë ¤)
await remoteConfigManager.fetchAndActivate()

// 3. TraceKitì— ì‹¤ì‹œê°„ ì ìš©
await remoteConfigManager.applyToTraceKit()
```

#### ì‹¤ì‹œê°„ ìë™ ì—…ë°ì´íŠ¸ (ê¶Œì¥)

Firebase Consoleì—ì„œ ì„¤ì •ì„ ë³€ê²½í•˜ë©´ ì•±ì´ ìë™ìœ¼ë¡œ ì•Œë¦¼ì„ ë°›ì•„ ì¦‰ì‹œ ë°˜ì˜í•©ë‹ˆë‹¤.

```swift
// ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ë¦¬ìŠ¤ë„ˆ ì‹œì‘
await remoteConfigManager.startRealtimeUpdates()

// Firebase Consoleì—ì„œ tracekit_min_levelì„ ë³€ê²½í•˜ë©´
// â†’ ì•±ì´ ìë™ìœ¼ë¡œ ì•Œë¦¼ ë°›ìŒ
// â†’ activate() ë° applyToTraceKit() ìë™ ì‹¤í–‰
// â†’ TraceKitì´ ì¦‰ì‹œ ìƒˆ ì„¤ì •ìœ¼ë¡œ ë™ì‘
```

**ë™ì‘ ë°©ì‹**:
```
1. Firebase Consoleì—ì„œ ì„¤ì • ë³€ê²½ (ì˜ˆ: tracekit_min_level = "verbose")
2. Firebaseê°€ ì—°ê²°ëœ ëª¨ë“  ì•±ì— í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡ (2-3ì´ˆ ì´ë‚´)
3. ì•±ì˜ addOnConfigUpdateListenerê°€ ì•Œë¦¼ ìˆ˜ì‹ 
4. ìë™ìœ¼ë¡œ activate() ì‹¤í–‰
5. ìë™ìœ¼ë¡œ applyToTraceKit() í˜¸ì¶œ
6. TraceKitì´ ì¦‰ì‹œ verbose ëª¨ë“œë¡œ ì „í™˜
7. ì‚¬ìš©ì ì•¡ì…˜ ë¶ˆí•„ìš”!
```

**ì£¼ì˜ì‚¬í•­**:
- ì•±ì´ í¬ê·¸ë¼ìš´ë“œ(ì‹¤í–‰ ì¤‘)ì¼ ë•Œë§Œ ë™ì‘
- ë°±ê·¸ë¼ìš´ë“œë‚˜ ì¢…ë£Œ ìƒíƒœì—ì„œëŠ” ë‹¤ìŒ ì‹¤í–‰ ì‹œ fetchAndActivate()ë¡œ ë™ê¸°í™”

#### UIì—ì„œ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨ (ìºì‹œ ë¬´ì‹œ)

RemoteConfigControl í™”ë©´ì—ì„œ "ìƒˆë¡œê³ ì¹¨" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìºì‹œë¥¼ ë¬´ì‹œí•˜ê³  ì¦‰ì‹œ ì„œë²„ì—ì„œ ìµœì‹  ì„¤ì •ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

```swift
// ìºì‹œ ë¬´ì‹œí•˜ê³  ì¦‰ì‹œ ê°€ì ¸ì˜¤ê¸°
let success = await remoteConfigManager.fetchAndActivateImmediately()

if success {
    // TraceKitì— ì¦‰ì‹œ ì ìš©
    await remoteConfigManager.applyToTraceKit()
}
```

**ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ vs ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨**:
| ë°©ì‹ | ë™ì‘ | ì‚¬ìš© ì‹œì  | ì‚¬ìš©ì ì•¡ì…˜ |
|-----|------|---------|----------|
| ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ | Console ë³€ê²½ ì‹œ ìë™ ë°˜ì˜ | ì¼ë°˜ì ì¸ ê²½ìš° (ê¶Œì¥) | ë¶ˆí•„ìš” |
| ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ | ë²„íŠ¼ í´ë¦­ ì‹œ ì¦‰ì‹œ ê°€ì ¸ì˜¤ê¸° | ì¦‰ì‹œ í™•ì¸ í•„ìš” ì‹œ | ë²„íŠ¼ í´ë¦­ |

#### ëŸ°íƒ€ì„ ì„¤ì • ì—…ë°ì´íŠ¸ ì§€ì›

- `applyToTraceKit()` ë©”ì„œë“œê°€ TraceKitì˜ `configure()` APIë¥¼ í˜¸ì¶œí•˜ì—¬ ëŸ°íƒ€ì„ ì„¤ì • ì—…ë°ì´íŠ¸
- ë¡œê·¸ ë ˆë²¨, ìƒ˜í”Œë§ ë¹„ìœ¨, ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹ ë“±ì„ ì•± ì¬ì‹œì‘ ì—†ì´ ë™ì  ë³€ê²½ ê°€ëŠ¥
- ë²„í¼ì™€ ìƒ˜í”ŒëŸ¬ë„ ìƒˆ ì„¤ì •ìœ¼ë¡œ ìë™ ì¬êµ¬ì„±
- ì„¤ì • ë³€ê²½ ì‹œ TraceKitì´ ìë™ìœ¼ë¡œ ë³€ê²½ ì´ë ¥ì„ ë¡œê¹…

**ëŸ°íƒ€ì„ ì—…ë°ì´íŠ¸ ë™ì‘**
```swift
// Remote Config ê°’ ë³€ê²½ ì‹œ:
// 1. minLevel: .info â†’ .debug ë³€ê²½
// 2. samplingRate: 1.0 â†’ 0.5 ë³€ê²½
// 3. sanitizer: true â†’ false ë³€ê²½
// â†’ TraceKitì´ ì¦‰ì‹œ ìƒˆ ì„¤ì •ìœ¼ë¡œ ë™ì‘
// â†’ ì„¤ì • ë³€ê²½ ë¡œê·¸ê°€ ìë™ìœ¼ë¡œ ê¸°ë¡ë¨
```

#### ì„¤ì • ê°’ í™•ì¸

```swift
// í˜„ì¬ ì ìš©ëœ ì„¤ì • í™•ì¸
let minLevel = await remoteConfigManager.minimumTraceLevel
let samplingRate = await remoteConfigManager.samplingRate
let isCrashlyticsEnabled = await remoteConfigManager.isCrashlyticsEnabled

print("ìµœì†Œ ë¡œê·¸ ë ˆë²¨: \(minLevel.name)")
print("ìƒ˜í”Œë§ ë¹„ìœ¨: \(samplingRate)")
```

#### Firebase Console ì„¤ì •

**Remote Config íŒŒë¼ë¯¸í„° ìƒì„±**
```
Firebase Console > Remote Config > Add parameter
- íŒŒë¼ë¯¸í„° í‚¤: tracekit_min_level
- ê¸°ë³¸ê°’: "info"
- ì¡°ê±´ë¶€ ê°’ (ì„ íƒì‚¬í•­):
  - ì¡°ê±´: iOS ë²„ì „ >= 17
  - ê°’: "debug"
```

**ë³€ê²½ì‚¬í•­ ë°°í¬**
```
1. íŒŒë¼ë¯¸í„° ìˆ˜ì •
2. ìš°ì¸¡ ìƒë‹¨ "Publish changes" í´ë¦­
3. ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ê°€ í™œì„±í™”ëœ ì•±ì— 2-3ì´ˆ ì´ë‚´ ìë™ ë°˜ì˜
   (ë˜ëŠ” ì£¼ê¸°ì  ê°±ì‹  ì‚¬ìš© ì‹œ ìµœëŒ€ 1ì‹œê°„ ì´ë‚´)
```

#### í™œìš© ì‹œë‚˜ë¦¬ì˜¤

**1. ê¸´ê¸‰ ë””ë²„ê¹… ëª¨ë“œ í™œì„±í™” (ì‹¤ì‹œê°„ ìë™)**

```
í”„ë¡œë•ì…˜ ì•±ì—ì„œ íŠ¹ì • ì‚¬ìš©ìì—ê²Œ ë²„ê·¸ ë°œìƒ
â†’ Firebase Consoleì—ì„œ tracekit_min_level = "verbose" ë³€ê²½
â†’ "Publish changes" í´ë¦­
â†’ 2-3ì´ˆ ì´ë‚´ ì‹¤í–‰ ì¤‘ì¸ ëª¨ë“  ì•±ì— ìë™ ë°˜ì˜
â†’ TraceKitì´ ì¦‰ì‹œ verbose ë ˆë²¨ë¡œ ì „í™˜ (ì‚¬ìš©ì ì•¡ì…˜ ë¶ˆí•„ìš”)
â†’ ìƒì„¸ ë¡œê·¸ ìˆ˜ì§‘ ì‹œì‘
â†’ ë²„ê·¸ ì›ì¸ íŒŒì•… í›„ ë‹¤ì‹œ "info"ë¡œ ë³µì›
```

**ì‹¤ì‹œê°„ ìë™ ë°˜ì˜ íë¦„**:
```
1. Consoleì—ì„œ ë³€ê²½: tracekit_min_level = "verbose"
2. Publish changes í´ë¦­
3. Firebaseê°€ ì•±ì— í‘¸ì‹œ ì•Œë¦¼ (2-3ì´ˆ)
4. ì•±ì˜ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆê°€ ê°ì§€
5. ìë™ìœ¼ë¡œ activate() + applyToTraceKit()
6. TraceKitì´ ì¦‰ì‹œ verbose ëª¨ë“œë¡œ ì „í™˜
7. ì½˜ì†” ë¡œê·¸ì— "ğŸ”” [Remote Config] ì„¤ì • ë³€ê²½ ê°ì§€" ì¶œë ¥
```

**2. A/B í…ŒìŠ¤íŠ¸**

```
ì¡°ê±´ A (50% ì‚¬ìš©ì): tracekit_sampling_rate = 1.0
ì¡°ê±´ B (50% ì‚¬ìš©ì): tracekit_sampling_rate = 0.5

â†’ ì„±ëŠ¥/ë¹„ìš© ì˜í–¥ ë¶„ì„ í›„ ìµœì ê°’ ê²°ì •
â†’ ì•± ì¬ì‹œì‘ ì—†ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒ˜í”Œë§ ë¹„ìœ¨ ë³€ê²½
```

**3. ë‹¨ê³„ì  ê¸°ëŠ¥ ë°°í¬**

```
ì´ˆê¸°: tracekit_enable_performance = false (10% ì‚¬ìš©ì)
1ì£¼ í›„: true (50% ì‚¬ìš©ì)
2ì£¼ í›„: true (100% ì‚¬ìš©ì)

â†’ Performance ë°ì´í„° ìˆ˜ì§‘ ì˜í–¥ ëª¨ë‹ˆí„°ë§
â†’ ì£¼ê¸°ì  ê°±ì‹ ì„ í†µí•´ ìë™ìœ¼ë¡œ ì„¤ì • ì ìš©
```

**4. ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ê°•í™”**

```
ì„œë²„ ì¥ì•  ê°ì§€ ì‹œ:
â†’ Remote Configì—ì„œ tracekit_min_level = "debug" ë³€ê²½
â†’ ëª¨ë“  ì‚¬ìš©ìì˜ ì•±ì´ 1ì‹œê°„ ì´ë‚´ ìë™ìœ¼ë¡œ ìƒì„¸ ë¡œê¹… ì‹œì‘
â†’ Firebase Analytics/Crashlyticsì— ë” ë§ì€ ì»¨í…ìŠ¤íŠ¸ ìˆ˜ì§‘
â†’ ì¥ì•  í•´ê²° í›„ "info"ë¡œ ë³µì›í•˜ì—¬ ë¡œê·¸ ë³¼ë¥¨ ê°ì†Œ
```

### í†µí•© ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ì™„ì „í•œ TraceKit + Firebase í†µí•©

```swift
import TraceKit
import FirebaseCore
import FirebaseAnalytics
import FirebaseCrashlytics
import FirebaseRemoteConfig
import FirebasePerformance

@main
struct MyApp: App {
    init() {
        Task {
            await setupTraceKitWithFirebase()
        }
    }
    
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}

func setupTraceKitWithFirebase() async {
    // 1. Firebase ì´ˆê¸°í™”
    FirebaseApp.configure()
    
    // 2. Remote Config ì„¤ì • ê°€ì ¸ì˜¤ê¸°
    let remoteConfigManager = FirebaseRemoteConfigManager()
    await remoteConfigManager.fetchAndActivate()
    
    let minLevel = await remoteConfigManager.minimumTraceLevel
    let samplingRate = await remoteConfigManager.samplingRate
    let isSanitizerEnabled = await remoteConfigManager.isSanitizerEnabled
    
    // 3. Firebase Destination ìƒì„±
    var analyticsDestination = FirebaseAnalyticsTraceDestination()
    var crashlyticsDestination = FirebaseCrashlyticsTraceDestination()
    
    // Remote Configì— ë”°ë¼ minLevel ì¡°ì • (ì„ íƒì‚¬í•­)
    analyticsDestination.minLevel = minLevel
    crashlyticsDestination.minLevel = minLevel
    
    // 4. TraceKit Configuration ìƒì„±
    let config = TraceKitConfiguration(
        minLevel: minLevel,
        isSanitizingEnabled: isSanitizerEnabled,
        sampleRate: samplingRate,
        bufferSize: 1000
    )
    
    // 5. TraceKit ì´ˆê¸°í™”
    await TraceKitBuilder()
        .addDestination(analyticsDestination)
        .addDestination(crashlyticsDestination)
        .configuration(config)
        .buildAsShared()
    
    // 6. UserContextProvider ì„¤ì • (ì„ íƒì‚¬í•­)
    let contextProvider = DefaultUserContextProvider()
    await TraceKit.async.setContextProvider(contextProvider)
    
    // 7. ì‹¤ì‹œê°„ Remote Config ìë™ ì—…ë°ì´íŠ¸ í™œì„±í™” (ê¶Œì¥)
    await remoteConfigManager.startRealtimeUpdates()
    // â†’ Firebase Consoleì—ì„œ ì„¤ì • ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ TraceKitì— ì ìš©
    // â†’ ì‚¬ìš©ì ì•¡ì…˜ ë¶ˆí•„ìš”, 2-3ì´ˆ ì´ë‚´ ë°˜ì˜
}
```

**ì‹¤ì‹œê°„ ìë™ ì—…ë°ì´íŠ¸ ë™ì‘ í™•ì¸**:
```
1. ì•± ì‹¤í–‰
2. Firebase Console > Remote Config > tracekit_min_level = "verbose"
3. "Publish changes" í´ë¦­
4. 2-3ì´ˆ í›„ ì•± ì½˜ì†”ì— ìë™ìœ¼ë¡œ ì¶œë ¥:
   ğŸ”” [Remote Config] ì„¤ì • ë³€ê²½ ê°ì§€ - ì—…ë°ì´íŠ¸ëœ í‚¤: ["tracekit_min_level"]
   âœ… [Remote Config] ë³€ê²½ëœ ì„¤ì • í™œì„±í™” ì™„ë£Œ
   âœ… [Remote Config] TraceKit ì„¤ì • ì ìš© ì™„ë£Œ
   â„¹ï¸ INFO [Configuration] TraceKit ì„¤ì • ì—…ë°ì´íŠ¸ ì™„ë£Œ
      old_min_level: INFO
      new_min_level: VERBOSE
5. ì¦‰ì‹œ verbose ë¡œê·¸ ì¶œë ¥ ì‹œì‘
```

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì „ì²´ ì¶”ì 

```swift
func fetchUserData() async throws -> User {
    // TraceKit ë¡œê·¸ + Firebase Performance ë™ì‹œ ì¶”ì 
    return try await FirebasePerformanceHelper.trace(name: "fetchUserData") {
        // 1. ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‹œì‘ ë¡œê·¸
        await TraceKit.async.info("Starting API request", category: "Network")
        
        // 2. ì‹¤ì œ ìš”ì²­
        let response = try await apiClient.get("/user")
        
        // 3. ì„±ê³µ ë¡œê·¸
        await TraceKit.async.info("API request succeeded", category: "Network")
        
        return response
    }
}

// ê²°ê³¼:
// - TraceKit ë¡œê·¸ â†’ Crashlytics Breadcrumbì— ê¸°ë¡
// - TraceKit ë¡œê·¸ â†’ Analytics ì´ë²¤íŠ¸ (error/fatalë§Œ)
// - TraceSpan â†’ Firebase Performance Custom Traceì— duration ê¸°ë¡
```

#### ì‹œë‚˜ë¦¬ì˜¤ 3: ì—ëŸ¬ ì¶”ì  ë° ë¶„ì„

```swift
func processPayment(order: Order) async throws {
    do {
        // 1. ì„±ëŠ¥ ì¶”ì  ì‹œì‘
        let spanId = await TraceKit.async.startSpan(name: "processPayment")
        
        // 2. ê²°ì œ ì²˜ë¦¬
        try await paymentGateway.charge(order.total)
        
        // 3. ì„±ê³µ ë¡œê·¸
        await TraceKit.async.info("Payment processed successfully", category: "Payment")
        
        // 4. Performance ë°ì´í„° ì „ì†¡
        if let span = await TraceKit.async.tracer.endSpan(id: spanId) {
            await span.sendToFirebasePerformance()
        }
        
    } catch {
        // 5. ì—ëŸ¬ ë¡œê·¸ (ìë™ìœ¼ë¡œ 3ê³³ì— ì „ì†¡)
        await TraceKit.async.error(
            "Payment failed: \(error.localizedDescription)",
            category: "Payment"
        )
        // â†’ Analytics: trace_error ì´ë²¤íŠ¸
        // â†’ Crashlytics: NSError ê¸°ë¡ + Breadcrumb
        // â†’ Console ë¡œê·¸
        
        throw error
    }
}
```

### Firebase Console í™•ì¸ ë°©ë²•

#### 1. Analytics ë°ì´í„° í™•ì¸

**ì‹¤ì‹œê°„ ë°ì´í„° (ì¦‰ì‹œ)**
```
Firebase Console > Analytics > Realtime
â†’ í˜„ì¬ í™œì„± ì‚¬ìš©ìì™€ trace_error/trace_fatal ì´ë²¤íŠ¸ ì‹¤ì‹œê°„ í™•ì¸
```

**ì´ë²¤íŠ¸ í†µê³„ (24ì‹œê°„ í›„)**
```
Firebase Console > Analytics > Events
â†’ trace_error ë˜ëŠ” trace_fatal í´ë¦­
â†’ ë°œìƒ íšŸìˆ˜, ì˜í–¥ë°›ì€ ì‚¬ìš©ì, ë””ë°”ì´ìŠ¤ë³„ ë¶„í¬ í™•ì¸
```

**BigQuery ì—°ë™ (ë¬´ë£Œ í”Œëœì—ì„œëŠ” ë¶ˆê°€)**
```
Firebase Console > Project settings > Integrations > BigQuery
â†’ Analytics ë°ì´í„°ë¥¼ BigQueryë¡œ ë‚´ë³´ë‚´ê¸°
â†’ SQLë¡œ ë³µì¡í•œ ë¶„ì„ ê°€ëŠ¥
```

#### 2. Crashlytics ë°ì´í„° í™•ì¸

**Non-fatal ì—ëŸ¬ í™•ì¸**
```
Firebase Console > Crashlytics > Dashboard
â†’ Non-fatal íƒ­ í´ë¦­
â†’ TraceKitì—ì„œ ê¸°ë¡í•œ error/fatal ë ˆë²¨ ë¡œê·¸ í™•ì¸
```

**Breadcrumb í™•ì¸**
```
Crashlytics > Issue í´ë¦­ > Keys íƒ­
â†’ í¬ë˜ì‹œ ë°œìƒ ì§ì „ TraceKit ë¡œê·¸ë¥¼ ì‹œê°„ìˆœìœ¼ë¡œ í™•ì¸
```

**ì‚¬ìš©ìë³„ ì´ìŠˆ ì¶”ì **
```
Crashlytics > Issue í´ë¦­ > Users íƒ­
â†’ ì–´ë–¤ ì‚¬ìš©ì(UserID)ì—ê²Œ ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸
```

#### 3. Performance ë°ì´í„° í™•ì¸

**Custom Traces**
```
Firebase Console > Performance > Custom traces
â†’ TraceKitì—ì„œ ì „ì†¡í•œ trace ì´ë¦„ ê²€ìƒ‰
â†’ Duration, Success rate, ë””ë°”ì´ìŠ¤ë³„ ì„±ëŠ¥ ë¹„êµ
```

**ì„¸ë¶€ ë¶„ì„**
```
Custom trace í´ë¦­ > Metrics íƒ­
â†’ duration_ms, memory_bytes ë“± ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ í™•ì¸
â†’ ì‹œê°„ëŒ€ë³„, OS ë²„ì „ë³„ ì„±ëŠ¥ íŠ¸ë Œë“œ ë¶„ì„
```

#### 4. Remote Config ì„¤ì •

**íŒŒë¼ë¯¸í„° ìƒì„±**
```
Firebase Console > Remote Config > Add parameter
â†’ í‚¤: tracekit_min_level
â†’ ê¸°ë³¸ê°’: "info"
â†’ ì¡°ê±´ë¶€ ê°’ ì¶”ê°€ (ì„ íƒì‚¬í•­)
```

**ë³€ê²½ì‚¬í•­ ë°°í¬**
```
íŒŒë¼ë¯¸í„° ìˆ˜ì • > Publish changes í´ë¦­
â†’ 1ì‹œê°„ ì´ë‚´ ì•±ì— ìë™ ë°˜ì˜
```

**ì¡°ê±´ë¶€ íƒ€ê²ŸíŒ…**
```
Add value for condition
â†’ iOS ë²„ì „, êµ­ê°€, ì–¸ì–´, ì•± ë²„ì „ ë“±ìœ¼ë¡œ ì„¸ë¶„í™”
â†’ íŠ¹ì • ì‚¬ìš©ì ê·¸ë£¹ì—ë§Œ ë‹¤ë¥¸ ì„¤ì • ì ìš©
```

### Firebase ë¬¸ì œ í•´ê²°

#### Q1. Firebase Consoleì— ë°ì´í„°ê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤

**Analytics ë°ì´í„°**
- Realtime íƒ­ì—ì„œ ëª‡ ì´ˆ ë‚´ í™•ì¸ ê°€ëŠ¥
- Events ì „ì²´ í†µê³„ëŠ” ìµœëŒ€ 24ì‹œê°„ ì†Œìš”
- ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”: `FirebaseAnalyticsDebugEnabled` í”Œë˜ê·¸ ì¶”ê°€

**Performance ë°ì´í„°**
- ì²« ë°ì´í„° í‘œì‹œê¹Œì§€ ëª‡ ë¶„ ~ 1ì‹œê°„ ì†Œìš”
- ë°ì´í„°ê°€ ì¶©ë¶„íˆ ìŒ“ì—¬ì•¼ í†µê³„ í‘œì‹œë¨

**Crashlytics ë°ì´í„°**
- ì•±ì„ ë°±ê·¸ë¼ìš´ë“œë¡œ ë³´ë‚¸ í›„ 30ì´ˆ ì´ë‚´ ì „ì†¡
- ë””ë²„ê·¸ ëª¨ë“œ: `FirebaseCrashlyticsCollectionEnabled` í™•ì¸

#### Q2. ë©”ì‹œì§€ê°€ ì˜ë¦½ë‹ˆë‹¤

Firebase AnalyticsëŠ” íŒŒë¼ë¯¸í„° ê°’ ê¸¸ì´ ì œí•œì´ ìˆìŠµë‹ˆë‹¤.

```swift
// í•´ê²° ë°©ë²•: ë©”ì‹œì§€ë¥¼ ì¤„ì´ê±°ë‚˜ ì¤‘ìš”í•œ ë¶€ë¶„ë§Œ ì¶”ì¶œ
let shortMessage = fullMessage.prefix(97) + "..."
```

#### Q3. Remote Config ë³€ê²½ì´ ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤

```swift
// ê°•ì œ ì—…ë°ì´íŠ¸ (ë””ë²„ê¹…ìš©)
let settings = RemoteConfigSettings()
settings.minimumFetchInterval = 0  // ì œí•œ ì—†ìŒ (í”„ë¡œë•ì…˜ì—ì„œëŠ” ì‚¬ìš© ê¸ˆì§€)
remoteConfig.configSettings = settings
```

#### Q4. Firebase Performance traceê°€ ìƒì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤

Trace ì´ë¦„ì´ Firebase ê·œì¹™ì„ ìœ„ë°˜í–ˆì„ ê°€ëŠ¥ì„±:

```swift
// ì˜ëª»ëœ ì´ë¦„
"User Profile - Fetch"  // ê³µë°±, í•˜ì´í”ˆ í¬í•¨

// ì˜¬ë°”ë¥¸ ì´ë¦„
"User_Profile_Fetch"    // ì–¸ë”ìŠ¤ì½”ì–´ë§Œ ì‚¬ìš©
```

#### Q5. ë„ˆë¬´ ë§ì€ Analytics ì´ë²¤íŠ¸ê°€ ì „ì†¡ë©ë‹ˆë‹¤

```swift
// FirebaseAnalyticsTraceDestinationì˜ minLevel ì¡°ì •
var analyticsDestination = FirebaseAnalyticsTraceDestination()
analyticsDestination.minLevel = .fatal  // fatalë§Œ ì „ì†¡

// TraceKitì— ì¶”ê°€
await TraceKit.async.addDestination(analyticsDestination)
```

#### Q6. Crashlyticsì— ì‚¬ìš©ì ì •ë³´ê°€ ë™ê¸°í™”ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤

```swift
// UserContextProviderë¡œ ì‚¬ìš©ì ì •ë³´ ì„¤ì •
let contextProvider = DefaultUserContextProvider()
await contextProvider.setUserId("user_12345")
await contextProvider.setCustomAttribute("plan", value: "premium")

await TraceKit.async.setContextProvider(contextProvider)

// ì´í›„ ëª¨ë“  ë¡œê·¸ì— ìë™ìœ¼ë¡œ UserContextê°€ ì²¨ë¶€ë¨
await TraceKit.async.error("Error occurred", category: "Payment")
```

### Firebase ì°¸ê³  ìë£Œ

- [Firebase Analytics ë¬¸ì„œ](https://firebase.google.com/docs/analytics)
- [Firebase Crashlytics ë¬¸ì„œ](https://firebase.google.com/docs/crashlytics)
- [Firebase Performance ë¬¸ì„œ](https://firebase.google.com/docs/perf-mon)
- [Firebase Remote Config ë¬¸ì„œ](https://firebase.google.com/docs/remote-config)

---

## ë‹¤ìŒ ë‹¨ê³„

- [ëŸ°íƒ€ì„ ì„¤ì •](./06-ëŸ°íƒ€ì„-ì„¤ì •.md) - Launch Argumentsë¡œ ë™ì  ì œì–´
- [ë°ëª¨ ì•±](./07-ë°ëª¨-ì•±.md) - Firebase ì—°ë™ ì‹¤ì œ êµ¬í˜„ í™•ì¸
