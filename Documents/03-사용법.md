# ğŸ“ ì‚¬ìš©ë²•

> ì‘ì„±ì¼: 2025-12-15  
> ìµœì¢… ì—…ë°ì´íŠ¸: 2026-02-04  
> ì‘ì„±ì: jimmy

> ğŸ’¡ **v1.2.1+ ìƒˆ ê¸°ëŠ¥**: Variadic Parametersë¥¼ ì‚¬ìš©í•œ ê°„ê²°í•œ metadata API  
> `("key", value)` í˜•ì‹ìœ¼ë¡œ `AnyCodable` ë˜í•‘ ì—†ì´ ë©”íƒ€ë°ì´í„°ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
> 45% ì½”ë“œ ê°ì†Œ, 50% íƒ€ì´í•‘ ì‹œê°„ ì ˆì•½!

## ê¸°ë³¸ ì‚¬ìš©ë²•

### 1. ê°€ì¥ ê°„ë‹¨í•œ ì‚¬ìš© (ë™ê¸° API)

TraceKitëŠ” `await` ì—†ì´ë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```swift
import TraceKit

// await ì—†ì´ ë°”ë¡œ ì‚¬ìš© (Fire-and-Forget)
TraceKit.info("ì•±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤")

// ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œë„ ë™ì¼í•˜ê²Œ ì‚¬ìš©
TraceKit.shared.info("ì•±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤")
```

### 2. ë ˆë²¨ë³„ ë¡œê¹…

```swift
import TraceKit

// ë™ê¸° API (await ë¶ˆí•„ìš”) - ê¶Œì¥
TraceKit.verbose("í•¨ìˆ˜ ì§„ì…: loadData()")
TraceKit.debug("API ìš”ì²­: GET /users")
TraceKit.info("ì‚¬ìš©ì ë¡œê·¸ì¸ ì„±ê³µ")
TraceKit.warning("í† í° ë§Œë£Œê¹Œì§€ 5ë¶„ ë‚¨ìŒ")
TraceKit.error("ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨")
TraceKit.fatal("ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¶ˆê°€")

// ë¹„ë™ê¸° API (await í•„ìš”) - ë¡œê·¸ ì™„ë£Œ ëŒ€ê¸° ì‹œ ì‚¬ìš©
Task {
    await TraceKit.shared.info("ë¡œê·¸ ì™„ë£Œê¹Œì§€ ëŒ€ê¸°")
}
```

### 3. ë™ê¸° vs ë¹„ë™ê¸° API

| ìƒí™© | ê¶Œì¥ API | ì˜ˆì‹œ |
|-----|---------|-----|
| ì¼ë°˜ ë¡œê¹… | ë™ê¸° (await ì—†ìŒ) | `TraceKit.info("message")` |
| UI/ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ | ë™ê¸° (await ì—†ìŒ) | `TraceKit.debug("button tapped")` |
| ë¡œê·¸ ì™„ë£Œ ëŒ€ê¸° í•„ìš” | ë¹„ë™ê¸° (await) | `await TraceKit.shared.info("...")` |
| í…ŒìŠ¤íŠ¸ì—ì„œ ê²€ì¦ | ë¹„ë™ê¸° (await) | `await TraceKit.shared.flush()` |

### 4. ì¹´í…Œê³ ë¦¬ì™€ ë©”íƒ€ë°ì´í„°

#### âœ¨ ìƒˆë¡œìš´ Variadic Parameters API (v1.2.1+, ê¶Œì¥)

```swift
import TraceKit

// ë™ê¸° APIë¡œ ì¹´í…Œê³ ë¦¬ ì§€ì •
TraceKit.info("API ìš”ì²­ ì‹œì‘", category: "Network")

// ë©”íƒ€ë°ì´í„° ì¶”ê°€ - AnyCodable ë˜í•‘ ë¶ˆí•„ìš”
TraceKit.info(
    "ì‚¬ìš©ì ë¡œê·¸ì¸",
    category: "Auth",
    ("userId", "user123"),
    ("method", "OAuth"),
    ("provider", "Google")
)

// ë‹¤ì–‘í•œ íƒ€ì… ìë™ ì§€ì›
TraceKit.info(
    "ê²°ì œ ì™„ë£Œ",
    category: "Payment",
    ("orderId", "ORD-2026-12345"),
    ("amount", 59800),
    ("isPaid", true),
    ("tax", 5980.0)
)
```

#### ê¸°ì¡´ Dictionary API (í•˜ìœ„ í˜¸í™˜)

```swift
import TraceKit

// ê¸°ì¡´ ë°©ì‹ë„ ì—¬ì „íˆ ë™ì‘
TraceKit.info(
    "ì‚¬ìš©ì ë¡œê·¸ì¸",
    category: "Auth",
    metadata: [
        "userId": AnyCodable("user123"),
        "method": AnyCodable("OAuth"),
        "provider": AnyCodable("Google")
    ]
)
```

#### Before & After ë¹„êµ

```swift
// ğŸ˜« Before (88íšŒì˜ AnyCodable ë˜í•‘)
TraceKit.info(
    "API í˜¸ì¶œ ì„±ê³µ",
    category: "Network",
    metadata: [
        "statusCode": AnyCodable(200),
        "url": AnyCodable("https://api.example.com"),
        "responseTime": AnyCodable(350.5),
        "method": AnyCodable("GET")
    ]
)

// âœ… After (45% ì½”ë“œ ê°ì†Œ)
TraceKit.info(
    "API í˜¸ì¶œ ì„±ê³µ",
    category: "Network",
    ("statusCode", 200),
    ("url", "https://api.example.com"),
    ("responseTime", 350.5),
    ("method", "GET")
)
```

## TraceKit ì„¤ì •

### TraceKitBuilder ì‚¬ìš©

```swift
import TraceKit

@main
struct MyApp: App {
    init() {
        Task {
            await setupTraceKit()
        }
    }
    
    @TraceKitActor
    func setupTraceKit() async {
        let logger = await TraceKitBuilder()
            // Destinations
            .addConsole(
                minLevel: .verbose,
                formatter: PrettyTraceFormatter.verbose
            )
            .addOSLog(
                subsystem: "com.myapp",
                minLevel: .info
            )
            .addFile(
                minLevel: .info,
                retentionPolicy: .default
            )
            // ì •ì±…
            .withBuffer(policy: .default)
            .withSampling(policy: .production)
            // ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹
            .withDefaultSanitizer()
            // ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸
            .withDefaultContextProvider(environment: .production)
            // Launch Argument ì ìš©
            .applyLaunchArguments()
            // ê³µìœ  ì¸ìŠ¤í„´ìŠ¤ë¡œ ë¹Œë“œ
            .buildAsShared()
    }
    
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}
```

### í”„ë¦¬ì…‹ ì‚¬ìš©

```swift
// ë””ë²„ê·¸ìš© (ëª¨ë“  ë¡œê·¸, ìƒì„¸ ì¶œë ¥)
let debugTraceKit = await TraceKitBuilder.debug().buildAsShared()

// í”„ë¡œë•ì…˜ìš© (ìµœì í™”ëœ ì„¤ì •)
let prodTraceKit = await TraceKitBuilder.production().buildAsShared()
```

### ë””ë²„ê·¸ í”„ë¦¬ì…‹ êµ¬ì„±

```swift
// TraceKitBuilder.debug()ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±ë©ë‹ˆë‹¤
TraceKitBuilder()
    .addConsole(formatter: PrettyTraceFormatter.verbose)
    .with(configuration: .debug)
    .withDefaultSanitizer()
    .applyLaunchArguments()
```

### í”„ë¡œë•ì…˜ í”„ë¦¬ì…‹ êµ¬ì„±

```swift
// TraceKitBuilder.production()ì€ ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±ë©ë‹ˆë‹¤
TraceKitBuilder()
    .addConsole(minLevel: .warning)
    .addOSLog(minLevel: .info)
    .addFile(minLevel: .info)
    .with(configuration: .production)
    .withBuffer(policy: .default)
    .withSampling(policy: .production)
    .withDefaultSanitizer()
    .withCrashPreservation()
    .applyLaunchArguments()
```

## Formatter

### PrettyTraceFormatter (ì½˜ì†”ìš©)

```swift
// ìµœì†Œ ì¶œë ¥ (ë ˆë²¨ + ë©”ì‹œì§€ë§Œ)
let minimal = PrettyTraceFormatter.minimal
// ì¶œë ¥: "â„¹ï¸ INFO ì•±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤"

// í‘œì¤€ ì¶œë ¥ (ê¸°ë³¸ê°’)
let standard = PrettyTraceFormatter.standard
// ì¶œë ¥: "14:32:15.123 â„¹ï¸ INFO [Default] ì•±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤ (App.swift:42)"

// ìƒì„¸ ì¶œë ¥ (ëª¨ë“  ì •ë³´)
let verbose = PrettyTraceFormatter.verbose
// ì¶œë ¥: "14:32:15.123 â„¹ï¸ INFO [Auth] ì‚¬ìš©ì ë¡œê·¸ì¸ (AuthManager.swift:123) {userId=user123, method=OAuth}"
```

ì»¤ìŠ¤í…€ ì„¤ì •:

```swift
let customFormatter = PrettyTraceFormatter(
    includeTimestamp: true,     // íƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨
    includeLocation: true,      // íŒŒì¼:ë¼ì¸ í¬í•¨
    includeMetadata: false,     // ë©”íƒ€ë°ì´í„° ì œì™¸
    useEmoji: false             // ì´ëª¨ì§€ ëŒ€ì‹  [LEVEL]
)
```

### JSONTraceFormatter (íŒŒì¼/ë¶„ì„ìš©)

```swift
let jsonFormatter = JSONTraceFormatter()
// ì¶œë ¥: {"category":"Auth","file":"AuthManager.swift",...}

let prettyJsonFormatter = JSONTraceFormatter(prettyPrint: true)
// ì¶œë ¥:
// {
//   "category": "Auth",
//   "file": "AuthManager.swift",
//   ...
// }
```

## ì¶œë ¥ ëŒ€ìƒ (Destinations)

### ConsoleTraceDestination

```swift
// ê¸°ë³¸ ì‚¬ìš©
let console = ConsoleTraceDestination()

// ì»¤ìŠ¤í…€ ì„¤ì •
let console = ConsoleTraceDestination(
    minLevel: .debug,
    isEnabled: true,
    formatter: PrettyTraceFormatter.verbose,
    outputStream: .auto  // error/fatalì€ stderr, ë‚˜ë¨¸ì§€ëŠ” stdout
)
```

### OSTraceDestination (iOS 14+)

```swift
let oslog = OSTraceDestination(
    subsystem: Bundle.main.bundleIdentifier ?? "com.myapp",
    minLevel: .info,
    isEnabled: true
)

// OSLog ë ˆë²¨ ë§¤í•‘
// verbose, debug â†’ OSLogType.debug
// info â†’ OSLogType.info
// warning â†’ OSLogType.default
// error â†’ OSLogType.error
// fatal â†’ OSLogType.fault
```

### FileTraceDestination

```swift
let fileManager = TraceFileManager(
    retentionPolicy: TraceFileRetentionPolicy(
        maxFileSize: 10 * 1024 * 1024,  // 10MB
        maxFileCount: 5,
        maxAge: 7 * 24 * 3600           // 7ì¼
    )
)

let file = FileTraceDestination(
    minLevel: .info,
    isEnabled: true,
    formatter: JSONTraceFormatter(),
    fileManager: fileManager,
    bufferSize: 10  // 10ê°œ ë¡œê·¸ í›„ íŒŒì¼ ì“°ê¸°
)
```

## Configuration

### TraceKitConfiguration

```swift
// ì§ì ‘ ìƒì„±
let config = TraceKitConfiguration(
    minLevel: .info,
    enabledCategories: ["Network", "Auth"],  // nilì´ë©´ ëª¨ë“  ì¹´í…Œê³ ë¦¬
    disabledDestinations: ["file"],          // ë¹„í™œì„±í™”í•  destination
    isSanitizingEnabled: true,               // ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹
    sampleRate: 0.5,                         // 50% ìƒ˜í”Œë§
    bufferSize: 100,
    flushInterval: 5.0
)

// í”„ë¦¬ì…‹
let debug = TraceKitConfiguration.debug       // ëª¨ë“  ë¡œê·¸, ë§ˆìŠ¤í‚¹ ë¹„í™œì„±í™”
let production = TraceKitConfiguration.production  // info ì´ìƒ, 10% ìƒ˜í”Œë§
```

### ëŸ°íƒ€ì„ ì„¤ì • ë³€ê²½

```swift
Task {
    // í˜„ì¬ ì„¤ì • ë³€ê²½
    await TraceKit.shared.configure(
        TraceKitConfiguration(minLevel: .warning)
    )
}
```

## ì‹¤ì „ ì˜ˆì œ

### ViewModelì—ì„œ ì‚¬ìš©

```swift
@MainActor
final class UserViewModel: ObservableObject {
    @Published var user: User?
    @Published var error: Error?
    
    func login(email: String, password: String) async {
        // âœ¨ v1.2.1+ Variadic Parameters API ì‚¬ìš© (ê¶Œì¥)
        TraceKit.info(
            "ë¡œê·¸ì¸ ì‹œë„",
            category: "Auth",
            ("email", email)  // ì´ë©”ì¼ì€ ìë™ ë§ˆìŠ¤í‚¹ë¨
        )
        
        do {
            user = try await authService.login(email: email, password: password)
            TraceKit.info("ë¡œê·¸ì¸ ì„±ê³µ", category: "Auth")
        } catch {
            self.error = error
            TraceKit.error(
                "ë¡œê·¸ì¸ ì‹¤íŒ¨: \(error.localizedDescription)",
                category: "Auth"
            )
        }
    }
}
```

### ë„¤íŠ¸ì›Œí¬ ë ˆì´ì–´ì—ì„œ ì‚¬ìš©

```swift
actor NetworkService {
    func request<T: Decodable>(_ endpoint: Endpoint) async throws -> T {
        // ì„±ëŠ¥ ì¶”ì ì€ ë¹„ë™ê¸° API ì‚¬ìš© (span ID ë°˜í™˜ í•„ìš”)
        let spanId = await TraceKit.shared.startSpan(name: "API: \(endpoint.path)")
        
        // âœ¨ v1.2.1+ Variadic Parameters API (ê¶Œì¥)
        TraceKit.debug(
            "API ìš”ì²­",
            category: "Network",
            ("method", endpoint.method.rawValue),
            ("path", endpoint.path)
        )
        
        do {
            let (data, response) = try await urlSession.data(for: endpoint.urlRequest)
            
            guard let httpResponse = response as? HTTPURLResponse else {
                throw NetworkError.invalidResponse
            }
            
            TraceKit.debug(
                "API ì‘ë‹µ",
                category: "Network",
                ("statusCode", httpResponse.statusCode),
                ("dataSize", data.count)
            )
            
            let result = try decoder.decode(T.self, from: data)
            
            await TraceKit.shared.endSpan(id: spanId)
            return result
            
        } catch {
            TraceKit.error(
                "API ì—ëŸ¬: \(error.localizedDescription)",
                category: "Network"
            )
            await TraceKit.shared.endSpan(id: spanId)
            throw error
        }
    }
}
```

### Repositoryì—ì„œ ì‚¬ìš©

```swift
actor UserRepository {
    private let networkService: NetworkService
    private let cache: UserCache
    
    func getUser(id: String) async throws -> User {
        // ë™ê¸° API ì‚¬ìš©
        TraceKit.verbose("getUser í˜¸ì¶œ", category: "Repository")
        
        // ìºì‹œ í™•ì¸
        if let cached = await cache.get(id: id) {
            TraceKit.debug("ìºì‹œ íˆíŠ¸", category: "Repository")
            return cached
        }
        
        TraceKit.debug("ìºì‹œ ë¯¸ìŠ¤, API í˜¸ì¶œ", category: "Repository")
        
        let user: User = try await networkService.request(.user(id: id))
        await cache.set(user)
        
        return user
    }
}
```

## ë‹¤ìŒ ë‹¨ê³„

- [ê³ ê¸‰ ê¸°ëŠ¥](./04-ê³ ê¸‰-ê¸°ëŠ¥.md) - ë²„í¼ë§, ìƒ˜í”Œë§, ë§ˆìŠ¤í‚¹ ìƒì„¸
- [ì™¸ë¶€ ì—°ë™](./05-ì™¸ë¶€-ì—°ë™.md) - Sentry, Datadog, Firebase ì—°ë™

