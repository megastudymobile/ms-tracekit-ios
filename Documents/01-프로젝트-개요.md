# ğŸ“± í”„ë¡œì íŠ¸ ê°œìš”

> ì‘ì„±ì¼: 2025-12-15
> ì‘ì„±ì: jimmy

## TraceKitë€?

TraceKitëŠ” iOS ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•œ ìœ ì—°í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ ë¡œê¹… í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. Swiftì˜ Actorë¥¼ í™œìš©í•œ ìŠ¤ë ˆë“œ ì•ˆì „í•œ ì„¤ê³„ì™€ ë‹¤ì–‘í•œ ì¶œë ¥ ëŒ€ìƒ ì§€ì›ì´ íŠ¹ì§•ì…ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

### 1. ë‹¤ì¤‘ ì¶œë ¥ ëŒ€ìƒ (Multi-Destination)

í•˜ë‚˜ì˜ ë¡œê·¸ë¥¼ ì—¬ëŸ¬ ê³³ì— ë™ì‹œì— ì¶œë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

| Destination | ì„¤ëª… | ìš©ë„ |
|-------------|------|------|
| Console | ì½˜ì†” ì¶œë ¥ | ê°œë°œ ì¤‘ ë””ë²„ê¹… |
| OSLog | Apple ì‹œìŠ¤í…œ ë¡œê·¸ | Instruments ì—°ë™, ì‹œìŠ¤í…œ ì½˜ì†” |
| File | íŒŒì¼ ì €ì¥ | ì˜¤í”„ë¼ì¸ ë¶„ì„, ë¡œê·¸ ì—…ë¡œë“œ |
| Sentry | ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ | í¬ë˜ì‹œ ì¶”ì , ì´ìŠˆ ê´€ë¦¬ |
| Datadog | ë¡œê·¸ ë¶„ì„ | ëŒ€ê·œëª¨ ë¡œê·¸ ë¶„ì„, ë©”íŠ¸ë¦­ |
| Firebase | Crashlytics | í¬ë˜ì‹œ ë¦¬í¬íŒ… |

### 2. ë¡œê·¸ ë ˆë²¨

6ë‹¨ê³„ì˜ ë¡œê·¸ ë ˆë²¨ë¡œ ì„¸ë°€í•œ ì œì–´ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤:

```
verbose â†’ debug â†’ info â†’ warning â†’ error â†’ fatal
   0        1       2       3         4       5
```

| ë ˆë²¨ | ì´ëª¨ì§€ | ì„¤ëª… | ì‚¬ìš© ì˜ˆì‹œ |
|-----|-------|------|----------|
| verbose | ğŸ“ | ê°€ì¥ ìƒì„¸í•œ ì¶”ì  | í•¨ìˆ˜ ì§„ì…/í‡´ì¶œ, ë³€ìˆ˜ ê°’ |
| debug | ğŸ” | ë””ë²„ê¹… ì •ë³´ | API ìš”ì²­ ìƒì„¸, ìƒíƒœ ë³€í™” |
| info | â„¹ï¸ | ì¼ë°˜ ì •ë³´ | ì‚¬ìš©ì ì•¡ì…˜, í™”ë©´ ì „í™˜ |
| warning | âš ï¸ | ì ì¬ì  ë¬¸ì œ | í† í° ë§Œë£Œ ì„ë°•, ë©”ëª¨ë¦¬ ë¶€ì¡± |
| error | âŒ | ì˜¤ë¥˜ ë°œìƒ | API ì‹¤íŒ¨, íŒŒì‹± ì—ëŸ¬ |
| fatal | ğŸ’€ | ì¹˜ëª…ì  ì˜¤ë¥˜ | ì•± í¬ë˜ì‹œ, ë°ì´í„° ì†ìƒ |

### 3. ë¯¼ê°ì •ë³´ ìë™ ë§ˆìŠ¤í‚¹

ë¡œê·¸ì— í¬í•¨ëœ ë¯¼ê°ì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ë§ˆìŠ¤í‚¹í•©ë‹ˆë‹¤:

```
ì›ë³¸: "ì‚¬ìš©ì ì´ë©”ì¼: john@example.com"
ì¶œë ¥: "ì‚¬ìš©ì ì´ë©”ì¼: [EMAIL]"

ì›ë³¸: "ì¹´ë“œë²ˆí˜¸: 1234-5678-9012-3456"
ì¶œë ¥: "ì¹´ë“œë²ˆí˜¸: [CREDIT_CARD]"
```

ê¸°ë³¸ ì§€ì› íŒ¨í„´:
- ì´ë©”ì¼ ì£¼ì†Œ
- ì‹ ìš©ì¹´ë“œ ë²ˆí˜¸
- ì „í™”ë²ˆí˜¸
- IP ì£¼ì†Œ
- JWT í† í°
- ë¹„ë°€ë²ˆí˜¸ í•„ë“œ

### 4. ë¡œê·¸ ìƒ˜í”Œë§

í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ë¡œê·¸ ë³¼ë¥¨ì„ ì œì–´í•©ë‹ˆë‹¤:

```swift
// í”„ë¡œë•ì…˜ ìƒ˜í”Œë§ ì •ì±…
SamplingPolicy(
    defaultRate: 0.1,        // ê¸°ë³¸ 10% ìˆ˜ì§‘
    ratesByLevel: [
        .verbose: 0.01,      // verboseëŠ” 1%ë§Œ
        .debug: 0.05,        // debugëŠ” 5%
        .warning: 0.5        // warningì€ 50%
    ],
    alwaysIncludeLevels: [.error, .fatal]  // ì—ëŸ¬ëŠ” 100%
)
```

### 5. ë¡œê·¸ ë²„í¼ë§

íš¨ìœ¨ì ì¸ ë°°ì¹˜ ì²˜ë¦¬ë¥¼ ìœ„í•œ ë²„í¼ë§:

```swift
TraceBufferPolicy(
    maxSize: 100,           // 100ê°œ ìŒ“ì´ë©´ í”ŒëŸ¬ì‹œ
    flushInterval: 5.0,     // 5ì´ˆë§ˆë‹¤ ìë™ í”ŒëŸ¬ì‹œ
    flushOnLevel: .error,   // ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ í”ŒëŸ¬ì‹œ
    flushOnBackground: true // ë°±ê·¸ë¼ìš´ë“œ ì§„ì… ì‹œ í”ŒëŸ¬ì‹œ
)
```

### 6. ì„±ëŠ¥ ì¶”ì  (Performance Tracing)

ì½”ë“œ ì‹¤í–‰ ì‹œê°„ì„ ì¸¡ì •í•˜ê³  ì¶”ì í•©ë‹ˆë‹¤:

```swift
// ìë™ ì¸¡ì •
let result = await TraceKit.shared.measure(name: "ë°ì´í„° ë¡œë”©") {
    await loadData()
}

// ìˆ˜ë™ ì¸¡ì • (ì¤‘ì²© ê°€ëŠ¥)
let parentId = await TraceKit.shared.startSpan(name: "ì „ì²´ ì‘ì—…")
    let childId = await TraceKit.shared.startSpan(name: "í•˜ìœ„ ì‘ì—…", parentId: parentId)
    // ...
    await TraceKit.shared.endSpan(id: childId)
await TraceKit.shared.endSpan(id: parentId)
```

## ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ë¶„ | ê¸°ìˆ  |
|-----|------|
| ì–¸ì–´ | Swift 6.0 |
| ìµœì†Œ ì§€ì› | iOS 15.0+ |
| ë¹Œë“œ ì‹œìŠ¤í…œ | Tuist |
| ë™ì‹œì„± | Swift Concurrency (Actor) |
| ì™¸ë¶€ ì˜ì¡´ì„± | ì—†ìŒ (Core ëª¨ë“ˆ ê¸°ì¤€) |

## ëª¨ë“ˆ êµ¬ì„±

```
TraceKit/
â”œâ”€â”€ TraceKit            # í•µì‹¬ í”„ë ˆì„ì›Œí¬ (ì˜ì¡´ì„± ì—†ìŒ)
â”œâ”€â”€ TraceKitSentry      # Sentry SDK ì—°ë™
â”œâ”€â”€ TraceKitDatadog     # Datadog SDK ì—°ë™
â””â”€â”€ TraceKitFirebase    # Firebase SDK ì—°ë™
```

### ëª¨ë“ˆë³„ ì˜ì¡´ì„±

| ëª¨ë“ˆ | ì™¸ë¶€ ì˜ì¡´ì„± |
|-----|------------|
| TraceKit | ì—†ìŒ |
| TraceKitSentry | Sentry SDK |
| TraceKitDatadog | Datadog SDK |
| TraceKitFirebase | Firebase Crashlytics |

## ì„¤ê³„ ì›ì¹™

### Actor ê¸°ë°˜ ìŠ¤ë ˆë“œ ì•ˆì „ì„±

ëª¨ë“  Destinationì€ Actorë¡œ êµ¬í˜„ë˜ì–´ ë°ì´í„° ë ˆì´ìŠ¤ë¥¼ ì›ì²œ ì°¨ë‹¨í•©ë‹ˆë‹¤:

```swift
public protocol TraceDestination: Actor {
    var identifier: String { get }
    var minLevel: TraceLevel { get set }
    func log(_ message: TraceMessage) async
}
```

### ë™ê¸°/ë¹„ë™ê¸° API ëª¨ë‘ ì§€ì›

TraceKitëŠ” `await` ì—†ì´ë„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” Fire-and-Forget APIë¥¼ ì œê³µí•©ë‹ˆë‹¤:

```swift
// ë™ê¸° API (await ë¶ˆí•„ìš”) - ê¶Œì¥
TraceKit.info("ì•±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤")
TraceKit.error("ì˜¤ë¥˜ ë°œìƒ", category: "Network")

// ë¹„ë™ê¸° API (await í•„ìš”) - ë¡œê·¸ ì™„ë£Œ ëŒ€ê¸° ì‹œ ì‚¬ìš©
await TraceKit.shared.info("ë¡œê·¸ ì™„ë£Œê¹Œì§€ ëŒ€ê¸°")
```

| API ìœ í˜• | ì‚¬ìš© ì‹œì  | ì˜ˆì‹œ |
|---------|---------|-----|
| ë™ê¸° | ì¼ë°˜ ë¡œê¹…, UI ì´ë²¤íŠ¸ | `TraceKit.info("...")` |
| ë¹„ë™ê¸° | ì™„ë£Œ ëŒ€ê¸°, í…ŒìŠ¤íŠ¸ | `await TraceKit.shared.info("...")` |

### ë¹Œë” íŒ¨í„´

ë³µì¡í•œ ì„¤ì •ì„ ì‰½ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```swift
let logger = await TraceKitBuilder()
    .addConsole(formatter: PrettyTraceFormatter.verbose)
    .addOSLog()
    .addFile(retentionPolicy: .default)
    .withBuffer(policy: .default)
    .withSampling(policy: .production)
    .withDefaultSanitizer()
    .buildAsShared()
```

### í”„ë¡œí† ì½œ ì§€í–¥ ì„¤ê³„

í•µì‹¬ ì»´í¬ë„ŒíŠ¸ë“¤ì€ í”„ë¡œí† ì½œë¡œ ì •ì˜ë˜ì–´ ì‰½ê²Œ í™•ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤:

- `TraceDestination`: ë¡œê·¸ ì¶œë ¥ ëŒ€ìƒ
- `TraceFormatter`: ë¡œê·¸ í¬ë§·í„°
- `TraceSanitizer`: ë¯¼ê°ì •ë³´ ì •ì œê¸°
- `UserContextProvider`: ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ ì œê³µì

## ë‹¤ìŒ ë‹¨ê³„

- [ì•„í‚¤í…ì²˜](./02-ì•„í‚¤í…ì²˜.md) - ë‚´ë¶€ êµ¬ì¡° ìì„¸íˆ ì•Œì•„ë³´ê¸°
- [ì‚¬ìš©ë²•](./03-ì‚¬ìš©ë²•.md) - ë°”ë¡œ ì‚¬ìš©í•´ë³´ê¸°

